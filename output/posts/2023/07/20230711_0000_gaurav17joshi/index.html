<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GSoC - Week 5-6 | Universe OpenAstronomy</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../../rss.xml">
<link rel="canonical" href="http://openastronomy.org/Universe_OA/posts/2023/07/20230711_0000_gaurav17joshi/">
<!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Gaurav Joshi">
<link rel="prev" href="../20230706_0000_1someshverma/" title="Improving time efficiency of Vaex Implementation" type="text/html">
<link rel="next" href="../20230714_0533_exitflynn/" title="Wild Wild Tests" type="text/html">
<meta property="og:site_name" content="Universe OpenAstronomy">
<meta property="og:title" content="GSoC - Week 5-6">
<meta property="og:url" content="http://openastronomy.org/Universe_OA/posts/2023/07/20230711_0000_gaurav17joshi/">
<meta property="og:description" content="Making a Demo
I had recently made some changes to my GP and GPResult class on the advice of my mentors and I realised that I am not making the tool keeping the user in mind.


See, in contemporary dat">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-07-11T00:00:00+01:00">
<meta property="article:tag" content="stingray">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../../../">

            <span id="blog-title">Universe OpenAstronomy</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
            <style>
@media screen and (max-width: 600px) {
.table-done {
    visibility: hidden;
    clear: both;
    padding: 0px 300px;
    width: 50%;
    display: block;
  }
}
            </style>
<div class="sidebar" style="width:100%; max-width:100%; float:initial; margin:0px;"><ul>
<li>
                   <img src="https://openastronomy.org/img/members/radis_ico.png" height="16" width="16"><a href="https://medium.com/@darshvn" data-toggle="tooltip" data-placement="top" title="2025-06-29 18:59:01+01:00">
                    Darshan Patil
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-05-01 - 2025-06-02">❌</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-02 - 2025-06-16">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-16 - 2025-06-30">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-30 - 2025-07-14">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-14 - 2025-07-28">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-28 - 2025-08-11">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-08-11 - 2025-08-25">🔲</span></span>
                </li>
<li>
                   <img src="https://github.com/juliaastro.png?size=40" height="16" width="16"><a href="https://kashish2210.blogspot.com" data-toggle="tooltip" data-placement="top" title="2025-06-29 06:26:00+01:00">
                    kashish shrivastav
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-05-01 - 2025-06-02">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-02 - 2025-06-16">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-16 - 2025-06-30">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-30 - 2025-07-14">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-14 - 2025-07-28">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-28 - 2025-08-11">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-08-11 - 2025-08-25">🔲</span></span>
                </li>
<li>
                   <img src="https://github.com/StingraySoftware.png?size=40" height="16" width="16"><a href="https://sejifukishima.blogspot.com" data-toggle="tooltip" data-placement="top" title="2025-07-03 11:15:00+01:00">
                    Mohammad Adnan
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-05-01 - 2025-06-02">❌</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-02 - 2025-06-16">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-16 - 2025-06-30">❌</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-30 - 2025-07-14">✅</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-14 - 2025-07-28">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-28 - 2025-08-11">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-08-11 - 2025-08-25">🔲</span></span>
                </li>
<li>
                   <img src="https://openastronomy.org/img/members/radis_ico.png" height="16" width="16"><a href="https://medium.com/@mohyware" data-toggle="tooltip" data-placement="top" title="2025-06-20 05:05:37+01:00">
                    mohyware
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-05-01 - 2025-06-02">❌</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-02 - 2025-06-16">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-16 - 2025-06-30">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-30 - 2025-07-14">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-14 - 2025-07-28">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-28 - 2025-08-11">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-08-11 - 2025-08-25">🔲</span></span>
                </li>
<li>
                   <img src="https://openastronomy.org/img/members/radis_ico.png" height="16" width="16"><a href="https://medium.com/@prathamhole" data-toggle="tooltip" data-placement="top" title="2025-07-02 08:58:20+01:00">
                    Pratham
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-05-01 - 2025-06-02">❌</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-02 - 2025-06-16">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-16 - 2025-06-30">❌</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-30 - 2025-07-14">✅</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-14 - 2025-07-28">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-28 - 2025-08-11">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-08-11 - 2025-08-25">🔲</span></span>
                </li>
</ul></div>
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">GSoC - Week 5-6</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../../authors/gaurav-joshi/">Gaurav Joshi</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-07-11T00:00:00+01:00" itemprop="datePublished" title="2023-07-11 00:00">2023-07-11 00:00</time></a>
            </p>
            

                    <p class="linkline"><a href="https://Gaurav17Joshi.github.io/Blogs/2023/07/11/W56.html">Original site</a></p>
        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <h3 id="making-a-demo">Making a Demo</h3>
<p>I had recently made some changes to my GP and GPResult class on the advice of my mentors and I realised that I am not making the tool keeping the user in mind.</p>

<!-- TEASER_END -->
<p>See, in contemporary data analysis, Gaussian Processes GP’s are very useful to fit and extrapolate the data. If we have some data points, we can use any suitable kernel function and a 0 mean and we will get a nicely fitting GP, which will also allow us to know function values at new points with error bars. But this is not what the users need in astronomy. They do not usually need to extrapolate the data to get values at new points, rather, they want to make a compare models with different charachteristics, signals, and identify which signal is present in the time series.</p>

<p>Thus making the demo notebook gave me an extrinsic view of the problem, and it made me change the arrangement of a lot of classes and functions in the code.</p>

<h3 id="new-implimenatations">New implimenatations</h3>

<h4 id="gpr-class">GPR class</h4>
<p>The big new implimentation that I made, was to entirely change the feature from having a GP class for data fitting and a GPResult class for bayesian inference to just the GPResult class for inferencing and plotting.</p>

<p>I changed the tool to just a GPResult class, that takes a suitable prior and log likelihood function samples out the posterior parameters. This also has a lot of new plotting features which are helpul to visualise the posterior parameter.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">GPResult</span><span class="p">:</span>
<span class="s">"""
Makes a GPResult object which takes in a Stingray.Lightcurve and samples parameters of a model
(Gaussian Process) based on the given prior and log_likelihood function.
"""</span>
<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Lc</span><span class="p">:</span> <span class="n">Lightcurve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
<span class="bp">self</span><span class="p">.</span><span class="n">lc</span> <span class="o">=</span> <span class="n">Lc</span>
<span class="bp">self</span><span class="p">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">Lc</span><span class="p">.</span><span class="n">time</span>
<span class="bp">self</span><span class="p">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">Lc</span><span class="p">.</span><span class="n">counts</span>
<span class="bp">self</span><span class="p">.</span><span class="n">Result</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior_model</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">likelihood_model</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="s">""" Makes a Jaxns nested sampler over the Gaussian Process, given the
prior and likelihood model """</span>
<span class="bp">self</span><span class="p">.</span><span class="n">prior_model</span> <span class="o">=</span> <span class="n">prior_model</span>
<span class="bp">self</span><span class="p">.</span><span class="n">likelihood_model</span> <span class="o">=</span> <span class="n">likelihood_model</span>

<span class="n">NSmodel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">prior_model</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">prior_model</span><span class="p">,</span> <span class="n">log_likelihood</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">likelihood_model</span><span class="p">)</span>
<span class="n">NSmodel</span><span class="p">.</span><span class="n">sanity_check</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">S</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="bp">self</span><span class="p">.</span><span class="n">Exact_ns</span> <span class="o">=</span> <span class="n">ExactNestedSampler</span><span class="p">(</span><span class="n">NSmodel</span><span class="p">,</span> <span class="n">num_live_points</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mf">1e4</span><span class="p">)</span>
<span class="n">Termination_reason</span><span class="p">,</span> <span class="n">State</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">Exact_ns</span><span class="p">(</span>
<span class="n">random</span><span class="p">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">42</span><span class="p">),</span> <span class="n">term_cond</span><span class="o">=</span><span class="n">TerminationCondition</span><span class="p">(</span><span class="n">live_evidence_frac</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">)</span>
<span class="p">)</span>
<span class="bp">self</span><span class="p">.</span><span class="n">Results</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">Exact_ns</span><span class="p">.</span><span class="n">to_results</span><span class="p">(</span><span class="n">State</span><span class="p">,</span> <span class="n">Termination_reason</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Simulation Complete"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_evidence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="s">""" Returns the log evidence of the model """</span>

<span class="k">def</span> <span class="nf">print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="s">""" Prints a summary table for the model parameters """</span>
</code></pre></div></div>

<p>And many other plotting functions like</p>

<ul>
<li>
<p>plot_diagnostics</p>
</li>
<li>
<p>plot_cornerplot</p>
</li>
<li>
<p>get_parameters_name</p>
</li>
<li>
<p>get_max_posterior_parameters</p>
</li>
<li>
<p>get_max_likelihood_parameters</p>
</li>
<li>
<p>posterior_plot</p>
</li>
<li>
<p>weighted_posterior_plot</p>
</li>
<li>
<p>corner_plot</p>
</li>
</ul>
<h4 id="get-prior-function">Get Prior function</h4>
<p>Earlier the <code class="language-plaintext highlighter-rouge">get_prior</code> function was a big function which took in your kernel and mean type, and gave you the prior function, but I had to write a separate function for each comibination making it a gignantic function of unecessary repeated code, also the prior ranges and distribution types (uniform, cauchy etc) was fixed according to what I had hard-coded without any way to change it. If someon wanted to implement a prior with even a small change, it was not possible.</p>

<p>So My mentor suggested making the function, such that the user inputs the tensorflow priors based on their needs, and we just make a jaxns prior for it. This led to the new code:-</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_prior</span><span class="p">(</span><span class="n">params_list</span><span class="p">,</span> <span class="n">prior_dict</span><span class="p">):</span>
<span class="s">"""
A prior generator function based on given values
"""</span>
<span class="k">def</span> <span class="nf">prior_model</span><span class="p">():</span>
<span class="n">prior_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">params_list</span><span class="p">:</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prior_dict</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tfpd</span><span class="p">.</span><span class="n">Distribution</span><span class="p">):</span>
<span class="n">parameter</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">Prior</span><span class="p">(</span><span class="n">prior_dict</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
<span class="n">parameter</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">prior_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">prior_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
<span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prior_list</span><span class="p">)</span>

<span class="k">return</span> <span class="n">prior_model</span>
</code></pre></div></div>

<h4 id="get-likelihood-function">Get likelihood function:</h4>
<p>Similarly I changed the likelihood functin so that it takes a parmeter array, and the kernel, mean type and gives us a log_likelihood function which calculates and gets the likelihood of the data being fitted for the parameters.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_likelihood</span><span class="p">(</span><span class="n">params_list</span><span class="p">,</span> <span class="n">kernel_type</span><span class="p">,</span> <span class="n">mean_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="s">"""
A likelihood generator function based on given values
"""</span>
<span class="o">@</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">likelihood_model</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">params_list</span><span class="p">):</span>
<span class="nb">dict</span><span class="p">[</span><span class="n">params</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">get_kernel</span><span class="p">(</span><span class="n">kernel_type</span><span class="o">=</span><span class="n">kernel_type</span><span class="p">,</span> <span class="n">kernel_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">get_mean</span><span class="p">(</span><span class="n">mean_type</span><span class="o">=</span><span class="n">mean_type</span><span class="p">,</span> <span class="n">mean_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
<span class="n">gp</span> <span class="o">=</span> <span class="n">GaussianProcess</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">"Times"</span><span class="p">],</span> <span class="n">mean_value</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">"Times"</span><span class="p">]))</span>
<span class="k">return</span> <span class="n">gp</span><span class="p">.</span><span class="n">log_probability</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">"counts"</span><span class="p">])</span>

<span class="k">return</span> <span class="n">likelihood_model</span>
</code></pre></div></div>

<h4 id="jit-issues">Jit issues</h4>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../categories/stingray/" rel="tag">stingray</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../20230706_0000_1someshverma/" rel="prev" title="Improving time efficiency of Vaex Implementation">Previous post</a>
            </li>
            <li class="next">
                <a href="../20230714_0533_exitflynn/" rel="next" title="Wild Wild Tests">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Contents © 2025         <a href="mailto:openastronomy@openastronomy.com">OpenAstronomy</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License BY-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="../../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
