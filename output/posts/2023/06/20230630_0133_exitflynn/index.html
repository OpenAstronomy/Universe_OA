<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Scraper Things | Universe OpenAstronomy</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../../rss.xml">
<link rel="canonical" href="http://openastronomy.org/Universe_OA/posts/2023/06/20230630_0133_exitflynn/">
<!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="exitflynn">
<link rel="prev" href="../20230625_1615_pupperemeritus/" title="GSoC Week 2-3 Update" type="text/html">
<link rel="next" href="../../07/20230702_1407_menasrac/" title="Setting Up for the Kurucz PR and transitioning to the TheoReTS" type="text/html">
<meta property="og:site_name" content="Universe OpenAstronomy">
<meta property="og:title" content="Scraper Things">
<meta property="og:url" content="http://openastronomy.org/Universe_OA/posts/2023/06/20230630_0133_exitflynn/">
<meta property="og:description" content="Most of the week was spent rewriting the Scraper functions to go with the new parse-pattern and then looking for edge cases in the new implementations, fixing bugs and updating tests.
{{Catching up}}
">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-06-30T01:33:30+01:00">
<meta property="article:tag" content="SunPy">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../../../">

            <span id="blog-title">Universe OpenAstronomy</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
            <style>
@media screen and (max-width: 600px) {
.table-done {
    visibility: hidden;
    clear: both;
    padding: 0px 300px;
    width: 50%;
    display: block;
  }
}
            </style>
<div class="sidebar" style="width:100%; max-width:100%; float:initial; margin:0px;"><ul>
<li>
                   <img src="https://cdn.rawgit.com/sunpy/sunpy-logo/master/generated/sunpy_icon.svg" height="16" width="16"><a href="https://exitflynn.github.io/blog/" data-toggle="tooltip" data-placement="top" title="2023-07-29 05:33:30+01:00" style="color:rgb(255,0,0)">
                    exitflynn
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-05-29 - 2023-06-12">âŒ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-12 - 2023-06-26">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-26 - 2023-07-03">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-03 - 2023-07-17">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-17 - 2023-07-31">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-31 - 2023-08-13">âŒ</span></span>
                </li>
<li>
                   <img src="https://github.com/StingraySoftware.png?size=40" height="16" width="16"><a href="https://Gaurav17Joshi.github.io" data-toggle="tooltip" data-placement="top" title="2023-07-28 00:00:00+01:00" style="color:rgb(255,0,0)">
                    Gaurav Joshi
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-05-29 - 2023-06-12">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-12 - 2023-06-26">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-26 - 2023-07-03">âŒ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-03 - 2023-07-17">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-17 - 2023-07-31">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-31 - 2023-08-13">âŒ</span></span>
                </li>
<li>
                   <img src="https://openastronomy.org/img/members/gnuastro.svg" height="16" width="16"><a href="https://Gaurav17Joshi.github.io" data-toggle="tooltip" data-placement="top" title="2023-07-28 00:00:00+01:00" style="color:rgb(255,0,0)">
                    Labib Asari
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-05-29 - 2023-06-12">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-12 - 2023-06-26">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-26 - 2023-07-03">âŒ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-03 - 2023-07-17">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-17 - 2023-07-31">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-31 - 2023-08-13">âŒ</span></span>
                </li>
<li>
                   <img src="https://github.com/StingraySoftware.png?size=40" height="16" width="16"><a href="https://dev.to/pupperemeritus" data-toggle="tooltip" data-placement="top" title="2023-08-13 10:23:47+01:00">
                    pupper emeritus
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-05-29 - 2023-06-12">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-12 - 2023-06-26">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-26 - 2023-07-03">âŒ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-03 - 2023-07-17">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-17 - 2023-07-31">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-31 - 2023-08-13">âŒ</span></span>
                </li>
<li>
                   <img src="https://openastronomy.org/img/members/radis_ico.png" height="16" width="16"><a href="https://medium.com/@menasrac" data-toggle="tooltip" data-placement="top" title="2023-08-11 17:23:24+01:00">
                    Racim MENASRIA
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-05-29 - 2023-06-12">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-12 - 2023-06-26">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-26 - 2023-07-03">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-03 - 2023-07-17">âŒ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-17 - 2023-07-31">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-31 - 2023-08-13">âœ…</span></span>
                </li>
<li>
                   <img src="https://openastronomy.org/img/members/radis_ico.png" height="16" width="16"><a href="https://1someshverma.github.io" data-toggle="tooltip" data-placement="top" title="2023-08-01 00:00:00+01:00">
                    Somesh Verma
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-05-29 - 2023-06-12">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-12 - 2023-06-26">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-06-26 - 2023-07-03">âŒ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-03 - 2023-07-17">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-17 - 2023-07-31">âœ…</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2023-07-31 - 2023-08-13">âœ…</span></span>
                </li>
</ul></div>
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Scraper Things</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../../authors/exitflynn/">exitflynn</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-06-30T01:33:30+01:00" itemprop="datePublished" title="2023-06-30 01:33">2023-06-30 01:33</time></a>
            </p>
            

                    <p class="linkline"><a href="https://exitflynn.github.io/blog/posts/gsoc-post-the-third/">Original site</a></p>
        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>Most of the week was spent rewriting the Scraper functions to go with the new parse-pattern and then looking for edge cases in the new implementations, fixing bugs and updating tests.</p>
<h2 id="catching-up">{{Catching up}}
<span>
<!-- TEASER_END -->
<a href="https://exitflynn.github.io/blog/tags/gsoc/index.xml#catching-up">
<svg height="100%" viewbox="0 0 28 23" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"></path></path></svg></a>
</span>
</h2>
<p>In the scraper, while trying to merge <code>baseurl</code> (an strftime formatted pattern i.e.<code> %Y%m</code> etc) and <code>pattern</code> (parse formatted pattern i.e. <code>{year:4d}{month:2d}</code> etc), I faced two choices, we could either:</p>
<ul>
<li>
<p>Make the input all parse-style formatted. generate the datetime-compatible string from here wherever it is required, however the problem i was running into here is parse-stuff like <code>{year:2d}</code> will collide with <code>{instrument}</code> like placeholders on which we mean to call <code>.format(**kwargs)</code> on. All the ways I could think of pulling it off included adding a large no. of lines of code in the really early part of <code>__init__()</code>.</p>
</li>
<li>
<p>Make the input all datetime formatted and generate the parse pattern from here. The problem with this is there are edge-cases when sometimes users define variables like <code>{Level:1d}</code> which we have no way of knowing beforehand. One way to go about this couldâ€™ve been that we tell the user to define a pattern string in addition to baseurl whenever they have any new variables like that.</p>
</li>
</ul>
<p>We ended up going with the first. My mentor, <a href="https://github.com/Nabobalis">Nabil</a> introduced me to how thereâ€™s a prevalence of using double-curly brackets in places where we need to escape / use them with single curly brackets, and sure enough, the <code>parse</code> module supports that. So that took care of the problem there, I was mostly a bit concerned that Iâ€™ll have to go back to the second way even though I had started with it before pivoting to the first one.</p>
<h2 id="communication">Communication
<span>
<a href="https://exitflynn.github.io/blog/tags/gsoc/index.xml#communication">
<svg height="100%" viewbox="0 0 28 23" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"></path></path></svg></a>
</span>
</h2>
<p>Nabil pointed out that we werenâ€™t being very good at communicating and that has a negative effect on the project which lead me to change how I was approaching it.</p>
<p>A lot of times I was debugging things by including print statements here and there, and since my project now involves changing API it had me updating tests and a lot of these times the problem would just be in my understanding on how to convert the patterns and just how the new input should look like. Previously, I would only send a message on the matrix room when I had a question. And most of the times Iâ€™d still hold out hope for solving something by myself when I have the strength to pick it up later. But it also makes sense because thereâ€™d be no way to differentiate that from me not doing anything. Also around 75% of the time Iâ€™ve drafted out questions, I found out an answer along the way. From now on I realise instead of just asking questions, I should think of it as a logging / progress-updating activity first which sounds obvious in hindsight.</p>
<h2 id="to-regex-or-not-to-regex">To regex or not to regex
<span>
<a href="https://exitflynn.github.io/blog/tags/gsoc/index.xml#to-regex-or-not-to-regex">
<svg height="100%" viewbox="0 0 28 23" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"></path></path></svg></a>
</span>
</h2>
<p>The next part where I was stuck at was in converting a pattern that involved custom placeholders like <code>{{CAR_ROT:4d}}</code> or <code>{{:3d}}</code> to their regex counterparts like  <code>(\d){3}</code>, <code>(\d){16}</code> etc without using like a l o t of regex, any less complex method than using a conversion function etc. However, after a quick conversation with the mentors and I realised that I had been mistakenly assuming that strftime required regex patterns. Earlier I thought that regex would no longer be part of the end-user experience but still somehow exist in the codebase but this is when I realised that we can entirely do away with it.</p>
<h2 id="rewrite-then-remove-">Rewrite then Remove? ğŸ’€
<span>
<a href="https://exitflynn.github.io/blog/tags/gsoc/index.xml#rewrite-then-remove-">
<svg height="100%" viewbox="0 0 28 23" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"></path></path></svg></a>
</span>
</h2>
<p>I also realised that the <code>_extractDateURL()</code> function was made redundant <em>after</em> rewriting it since I found out later that it was only called at one place and that part of the code was no longer required thanks to the existence of a parse-pattern. Thatâ€™s a nice message to keep in mind for the future.</p>
<h2 id="modern-day-cain">Modern Day Cain
<span>
<a href="https://exitflynn.github.io/blog/tags/gsoc/index.xml#modern-day-cain">
<svg height="100%" viewbox="0 0 28 23" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"></path></path></svg></a>
</span>
</h2>
<p>Another question I encountered was if we could assume that any {year:2d} or %y type 2-digit year xx to be interpreted to be in the 21st century like 20xx or not.</p>
<h2 id="issue-found">Issue found
<span>
<a href="https://exitflynn.github.io/blog/tags/gsoc/index.xml#issue-found">
<svg height="100%" viewbox="0 0 28 23" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"></path></path></svg></a>
</span>
</h2>
<p>I also found this bug in the codebase:
In the current <code>scraper._check_timerange()</code>, it takes the simpler way <code>if</code> we provide it with an extractor // parse-pattern and a more complex way if we donâ€™t, however as it is implemented right now</p>
<div class="highlight"><pre tabindex="0"><code class="language-python"><span style="display: flex;"><span><span style="color: #f92672;">from</span> sunpy.net.scraper <span style="color: #f92672;">import</span> Scraper
</span></span><span style="display: flex;"><span><span style="color: #f92672;">from</span> sunpy.time <span style="color: #f92672;">import</span> TimeRange
</span></span><span style="display: flex;"><span>s <span style="color: #f92672;">=</span> Scraper(<span style="color: #e6db74;">'%Y.fits'</span>)
</span></span><span style="display: flex;"><span>s<span style="color: #f92672;">.</span>_check_timerange(<span style="color: #e6db74;">'2014.fits'</span>, TimeRange(<span style="color: #e6db74;">"2015-01-01"</span>, <span style="color: #e6db74;">"2015-01-02"</span>))
</span></span></code></pre></div>
<p>would return True and it is intended that way in the tests but if we passed it an extractor // parse pattern</p>
<div class="highlight"><pre tabindex="0"><code class="language-python"><span style="display: flex;"><span>s<span style="color: #f92672;">.</span>extractor <span style="color: #f92672;">=</span> <span style="color: #e6db74;">"</span><span style="color: #e6db74;">{year:4d}</span><span style="color: #e6db74;">.fits"</span>
</span></span><span style="display: flex;"><span>s<span style="color: #f92672;">.</span>_check_timerange(<span style="color: #e6db74;">'2014.fits'</span>, TimeRange(<span style="color: #e6db74;">"2015-01-01"</span>, <span style="color: #e6db74;">"2015-01-02"</span>))
</span></span></code></pre></div>
<p>itâ€™d return False.</p>
<h2 id="inclusivity-is-important">Inclusivity is important
<span>
<a href="https://exitflynn.github.io/blog/tags/gsoc/index.xml#inclusivity-is-important">
<svg height="100%" viewbox="0 0 28 23" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"></path></path></svg></a>
</span>
</h2>
<p>Failing tests required me to inqure if we want closed-intervals in the package or open, which concluded with closed. I also found other instances in the codebase where we endorse closed intervals.</p>
<h2 id="future-steps">Future steps
<span>
<a href="https://exitflynn.github.io/blog/tags/gsoc/index.xml#future-steps">
<svg height="100%" viewbox="0 0 28 23" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"></path></path></svg></a>
</span>
</h2>
<p>Cover why the rest of tests are breaking and fix em.
Ask for review once everything works.
Try to come up with a way to write parse-patterns so as the length remains less by trying to minimize repeated values.
Also fix my Hugo setup before the night -_-</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../categories/sunpy/" rel="tag">SunPy</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../20230625_1615_pupperemeritus/" rel="prev" title="GSoC Week 2-3 Update">Previous post</a>
            </li>
            <li class="next">
                <a href="../../07/20230702_1407_menasrac/" rel="next" title="Setting Up for the Kurucz PR and transitioning to the TheoReTS">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Contents Â© 2023         <a href="mailto:openastronomy@openastronomy.com">OpenAstronomy</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License BY-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="../../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
