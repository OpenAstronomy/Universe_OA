<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>GSoC 2020: glue-solar project 2.1 | Universe OpenAstronomy</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../../rss.xml">
<link rel="canonical" href="http://openastronomy.org/Universe_OA/posts/2020/07/20200712_2340_kakirastern/">
<!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Kris Stern">
<link rel="prev" href="../../06/20200630_0954_jes24/" title="GSoC 2020: Blog 2 - Parameters and incompatible units" type="text/html">
<link rel="next" href="../20200713_0044_siddharthlal25/" title="Week 5 &amp; 6: The second month begins!" type="text/html">
<meta property="og:site_name" content="Universe OpenAstronomy">
<meta property="og:title" content="GSoC 2020: glue-solar project 2.1">
<meta property="og:url" content="http://openastronomy.org/Universe_OA/posts/2020/07/20200712_2340_kakirastern/">
<meta property="og:description" content="The second coding period is now officially halfway through. Since the end of the first coding period, I have been working on both the 1D Profile viewer and WCS autolinking. Since much has been discuss">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-07-12T23:40:22+01:00">
<meta property="article:tag" content="SunPy">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../../../">

            <span id="blog-title">Universe OpenAstronomy</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
            <style>
@media screen and (max-width: 600px) {
.table-done {
    visibility: hidden;
    clear: both;
    padding: 0px 300px;
    width: 50%;
    display: block;
  }
}
            </style>
<div class="sidebar" style="width:100%; max-width:100%; float:initial; margin:0px;"><ul>
<li>
                   <img src="https://openastronomy.org/img/members/radis_ico.png" height="16" width="16"><a href="https://medium.com/@darshvn" data-toggle="tooltip" data-placement="top" title="2025-06-07 04:22:57+01:00">
                    Darshan Patil
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-05-01 - 2025-06-02">❌</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-02 - 2025-06-16">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-16 - 2025-06-30">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-06-30 - 2025-07-14">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-14 - 2025-07-28">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-28 - 2025-08-11">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-08-11 - 2025-08-25">🔲</span></span>
                </li>
<li>
                   <img src="https://github.com/juliaastro.png?size=40" height="16" width="16"><a href="https://kashish2210.blogspot.com" data-toggle="tooltip" data-placement="top" title="2025-06-13 07:32:00+01:00">
                    kashish shrivastav
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-05-01 - 2025-06-02">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-02 - 2025-06-16">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-16 - 2025-06-30">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-06-30 - 2025-07-14">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-14 - 2025-07-28">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-28 - 2025-08-11">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-08-11 - 2025-08-25">🔲</span></span>
                </li>
<li>
                   <img src="https://github.com/StingraySoftware.png?size=40" height="16" width="16"><a href="https://sejifukishima.blogspot.com" data-toggle="tooltip" data-placement="top" title="2025-06-04 18:03:00+01:00">
                    Mohammad Adnan
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-05-01 - 2025-06-02">❌</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-02 - 2025-06-16">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-16 - 2025-06-30">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-06-30 - 2025-07-14">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-14 - 2025-07-28">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-28 - 2025-08-11">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-08-11 - 2025-08-25">🔲</span></span>
                </li>
<li>
                   <img src="https://openastronomy.org/img/members/radis_ico.png" height="16" width="16"><a href="https://medium.com/@mohyware" data-toggle="tooltip" data-placement="top" title="2025-06-05 02:25:44+01:00">
                    mohyware
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-05-01 - 2025-06-02">❌</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-02 - 2025-06-16">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-16 - 2025-06-30">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-06-30 - 2025-07-14">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-14 - 2025-07-28">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-28 - 2025-08-11">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-08-11 - 2025-08-25">🔲</span></span>
                </li>
<li>
                   <img src="https://openastronomy.org/img/members/radis_ico.png" height="16" width="16"><a href="https://medium.com/@prathamhole" data-toggle="tooltip" data-placement="top" title="2025-06-07 09:49:18+01:00">
                    Pratham
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-05-01 - 2025-06-02">❌</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-02 - 2025-06-16">✅</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2025-06-16 - 2025-06-30">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-06-30 - 2025-07-14">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-14 - 2025-07-28">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-07-28 - 2025-08-11">🔲</span><span style="display:table-cell; width:7%;opacity: 0.5;" data-toggle="tooltip" title="2025-08-11 - 2025-08-25">🔲</span></span>
                </li>
</ul></div>
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">GSoC 2020: glue-solar project 2.1</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../../authors/kris-stern/">Kris Stern</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-07-12T23:40:22+01:00" itemprop="datePublished" title="2020-07-12 23:40">2020-07-12 23:40</time></a>
            </p>
            

                    <p class="linkline"><a href="https://medium.com/@krisastern/gsoc-2020-glue-solar-project-2-1-620347ad3f8d?source=rss-33703681b362------2">Original site</a></p>
        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>The second coding period is now officially halfway through. Since the end of the first coding period, I have been working on both the <a href="https://github.com/glue-viz/glue/pull/2156">1D Profile viewer</a> and <a href="https://github.com/glue-viz/glue/pull/2161">WCS autolinking</a>. Since much has been discussed about the 1D Profile viewer of glue and now that it is finally working, let me take the opportunity to talk about the wcs-autolinking PR.</p>
<p><strong>Problem statement</strong>: Originally the wcs-autolinking only worked for some cases, for example for the spatial axes but not for the temporal and wavelength axes in the scenario where the dimensions of the two wcs objects of the data cubes being matched up do not match. This is highly undesirable and needs generalizing while conforming to <a href="https://github.com/astropy/astropy-APEs/blob/master/APE14.rst">APE 14</a>, where the issue of a shared Python interface for World Coordinate Systems is discussed.</p>
<p><strong>The solution</strong>: So we rewrote the code. Most of the celestial code has been retained, with some new additions to add linking for the other dimensions. The code rewritten is as follows:</p>
<!-- TEASER_END -->
<pre># Case for when the axes don't exactly match up<br>
if not forwards or not backwards:</pre>
<pre>    # A generalized APE 14-compatible way<br>
# Handle also the extra-spatial axes such as those of the time and wavelength dimensions</pre>
<pre>    if not wcs1.has_celestial or not wcs2.has_celestial:<br>
raise IncompatibleWCS("Can't create WCS link between {0} and {1}".format(data1.label, data2.label))</pre>
<pre>    try:<br>
wcs1_celestial = wcs1.celestial<br>
wcs2_celestial = wcs2.celestial<br>
wcs1_celestial_axis_physical_types = wcs1.celestial.world_axis_physical_types<br>
wcs2_celestial_axis_physical_types = wcs2.celestial.world_axis_physical_types<br>
print('wcs1.celestial.world_axis_physical_types', wcs1_celestial_axis_physical_types)<br>
print('wcs2.celestial.world_axis_physical_types', wcs2_celestial_axis_physical_types)<br>
except Exception:<br>
raise IncompatibleWCS("Can't create WCS link between {0} and {1}".format(data1.label, data2.label))</pre>
<pre>    cids1 = data1.pixel_component_ids<br>
cids1_celestial = [cids1[wcs1.wcs.naxis - wcs1.wcs.lng - 1],<br>
cids1[wcs1.wcs.naxis - wcs1.wcs.lat - 1]]<br>
slicing_axes_celestial1 = [cids1_celestial[0].axis, cids1_celestial[1].axis]<br>
slicing_axes_celestial1 = sorted(slicing_axes_celestial1, key=str, reverse=False)<br>
print('slicing_axes_celestial1', slicing_axes_celestial1)</pre>
<pre>    if wcs1_celestial.wcs.lng &gt; wcs1_celestial.wcs.lat:<br>
cids1_celestial = cids1_celestial[::-1]</pre>
<pre>    cids2 = data2.pixel_component_ids<br>
cids2_celestial = [cids2[wcs2.wcs.naxis - wcs2.wcs.lng - 1],<br>
cids2[wcs2.wcs.naxis - wcs2.wcs.lat - 1]]<br>
slicing_axes_celestial2 = [cids2_celestial[0].axis, cids2_celestial[1].axis]<br>
slicing_axes_celestial2 = sorted(slicing_axes_celestial2, key=str, reverse=False)<br>
print('slicing_axes_celestial2', slicing_axes_celestial2)</pre>
<pre>    if wcs2_celestial.wcs.lng &gt; wcs2_celestial.wcs.lat:<br>
cids2_celestial = cids2_celestial[::-1]</pre>
<pre>    # Collect all apparently matching axes in two lists for the two wcs objects being linked up<br>
wcs1_sliced_physical_types = wcs1_celestial_axis_physical_types<br>
slicing_axes1 = slicing_axes_celestial1<br>
wcs2_sliced_physical_types = wcs2_celestial_axis_physical_types<br>
slicing_axes2 = slicing_axes_celestial2<br>
for i, physical_type1 in enumerate(wcs1.world_axis_physical_types):<br>
for j, physical_type2 in enumerate(wcs2.world_axis_physical_types):<br>
if physical_type1 == physical_type2:<br>
if physical_type1 not in wcs1_sliced_physical_types:<br>
slicing_axes1.append(wcs1.world_n_dim - i - 1)<br>
wcs1_sliced_physical_types.append(physical_type1)<br>
if physical_type2 not in wcs2_sliced_physical_types:<br>
slicing_axes2.append(wcs2.world_n_dim - j - 1)<br>
wcs2_sliced_physical_types.append(physical_type2)</pre>
<pre>    slicing_axes1 = sorted(slicing_axes1, key=str, reverse=True)<br>
slicing_axes2 = sorted(slicing_axes2, key=str, reverse=True)</pre>
<pre>    print('slicing_axes1', slicing_axes1)<br>
print('slicing_axes2', slicing_axes2)</pre>
<pre>    print('wcs1_sliced_physical_types', wcs1_sliced_physical_types)<br>
print('wcs2_sliced_physical_types', wcs2_sliced_physical_types)</pre>
<pre>    # Generate slices for the wcs slicing<br>
slices1 = (slice(None),) * wcs1.world_n_dim<br>
slices2 = (slice(None),) * wcs2.world_n_dim</pre>
<pre>    slices1 = sorted(list(slices1))<br>
slices2 = sorted(list(slices2))</pre>
<pre>    for i in range(wcs1.world_n_dim):<br>
if i in slicing_axes1:<br>
pass<br>
else:<br>
slices1[i] = 0</pre>
<pre>    for i in range(wcs2.world_n_dim):<br>
if i in slicing_axes2:<br>
pass<br>
else:<br>
slices2[i] = 0</pre>
<pre>    wcs1_sliced = wcs1[tuple(slices1)]<br>
wcs2_sliced = wcs2[tuple(slices2)]</pre>
<pre>    cids1 = data1.pixel_component_ids<br>
cids1_sliced = [cids1[x] for x in slicing_axes1]<br>
cids1_sliced = sorted(cids1_sliced, key=str, reverse=True)</pre>
<pre>    cids2 = data2.pixel_component_ids<br>
cids2_sliced = [cids2[x] for x in slicing_axes2]<br>
cids2_sliced = sorted(cids2_sliced, key=str, reverse=True)</pre>
<pre>    pixel_cids1, pixel_cids2, forwards, backwards = get_cids_and_functions(<br>
wcs1_sliced, wcs2_sliced, cids1_sliced, cids2_sliced)</pre>
<pre>    self._physical_types_1 = wcs1_sliced_physical_types<br>
self._physical_types_2 = wcs2_sliced_physical_types</pre>
<pre>    if pixel_cids1 is None:<br>
raise IncompatibleWCS("Can't create WCS link between {0} and {1}".format(data1.label, data2.label))</pre>
<p>After checking with the tests written previously the code was modified before it is confirmed with pytest that all CI tests are now passing.</p>
<p>Now we can link up wcs axes of the same physical types of two data cubes having different dimensions with no problems, illustrated as follows:</p>
<figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*Ffgo6t1M0ah9UcCyeLVdfg.png"></figure><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=620347ad3f8d" width="1" height="1">
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../categories/sunpy/" rel="tag">SunPy</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../06/20200630_0954_jes24/" rel="prev" title="GSoC 2020: Blog 2 - Parameters and incompatible units">Previous post</a>
            </li>
            <li class="next">
                <a href="../20200713_0044_siddharthlal25/" rel="next" title="Week 5 &amp; 6: The second month begins!">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Contents © 2025         <a href="mailto:openastronomy@openastronomy.com">OpenAstronomy</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License BY-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="../../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
