<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Deeper into OpenCL | Universe OpenAstronomy</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../../rss.xml">
<link rel="canonical" href="http://openastronomy.org/Universe_OA/posts/2024/06/20240622_2045_deadspheroid/">
<!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="DeadSpheroid">
<link rel="prev" href="../20240621_1329_kartikmandar/" title="Making the sidebar intuitive" type="text/html">
<link rel="next" href="../20240623_0000_code29563/" title="Stark broadening and the Common API" type="text/html">
<meta property="og:site_name" content="Universe OpenAstronomy">
<meta property="og:title" content="Deeper into OpenCL">
<meta property="og:url" content="http://openastronomy.org/Universe_OA/posts/2024/06/20240622_2045_deadspheroid/">
<meta property="og:description" content="In this post, I hope to give a high level understanding of OpenCL and its workings

Setting it up




OpenCL is relatively easy to get up and running on your system.



For users:
All you need, is the">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-06-22T20:45:00+01:00">
<meta property="article:tag" content="gnuastro">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../../../">

            <span id="blog-title">Universe OpenAstronomy</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
            <style>
@media screen and (max-width: 600px) {
.table-done {
    visibility: hidden;
    clear: both;
    padding: 0px 300px;
    width: 50%;
    display: block;
  }
}
            </style>
<div class="sidebar" style="width:100%; max-width:100%; float:initial; margin:0px;"><ul>
<li>
                   <img src="https://cdn.rawgit.com/sunpy/sunpy-logo/master/generated/sunpy_icon.svg" height="16" width="16"><a href="https://dev.to/ahmedhosssam" data-toggle="tooltip" data-placement="top" title="2024-07-11 19:38:21+01:00" style="color:rgb(255,0,0)">
                    Ahmed Hossam
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-05-27 - 2024-06-10">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-10 - 2024-06-24">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-24 - 2024-07-01">‚ùå</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-01 - 2024-07-15">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-15 - 2024-07-29">‚ùå</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-29 - 2024-08-12">üî≤</span></span>
                </li>
<li>
                   <img src="https://openastronomy.org/img/members/radis_ico.png" height="16" width="16"><a href="http://code29563.github.io" data-toggle="tooltip" data-placement="top" title="2024-07-29 00:00:00+01:00">
                    code29563
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-05-27 - 2024-06-10">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-10 - 2024-06-24">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-24 - 2024-07-01">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-01 - 2024-07-15">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-15 - 2024-07-29">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-29 - 2024-08-12">üî≤</span></span>
                </li>
<li>
                   <img src="https://openastronomy.org/img/members/gnuastro.svg" height="16" width="16"><a href="https://deadspheroid.github.io" data-toggle="tooltip" data-placement="top" title="2024-07-28 22:30:00+01:00">
                    DeadSpheroid
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-05-27 - 2024-06-10">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-10 - 2024-06-24">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-24 - 2024-07-01">‚ùå</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-01 - 2024-07-15">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-15 - 2024-07-29">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-29 - 2024-08-12">üî≤</span></span>
                </li>
<li>
                   <img src="https://cdn.rawgit.com/sunpy/sunpy-logo/master/generated/sunpy_icon.svg" height="16" width="16"><a href="https://deus1704.vercel.app" data-toggle="tooltip" data-placement="top" title="2024-07-22 18:59:31+01:00" style="color:rgb(255,0,0)">
                    Deus1704
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-05-27 - 2024-06-10">‚ùå</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-10 - 2024-06-24">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-24 - 2024-07-01">‚ùå</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-01 - 2024-07-15">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-15 - 2024-07-29">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-29 - 2024-08-12">üî≤</span></span>
                </li>
<li>
                   <img src="https://github.com/StingraySoftware.png?size=40" height="16" width="16"><a href="https://gsoc2024.kartikmandar.com" data-toggle="tooltip" data-placement="top" title="2024-08-05 16:05:00+01:00">
                    Kartik Mandar
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-05-27 - 2024-06-10">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-10 - 2024-06-24">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-24 - 2024-07-01">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-01 - 2024-07-15">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-15 - 2024-07-29">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-29 - 2024-08-12">‚úÖ</span></span>
                </li>
<li>
                   <img src="https://github.com/fornax-navo.png?size=40" height="16" width="16"><a href="https://lucasmartingarciagsoc24openastronomy.blogspot.com" data-toggle="tooltip" data-placement="top" title="2024-07-15 19:57:00+01:00" style="color:rgb(255,0,0)">
                    Lucas Martin Garcia
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-05-27 - 2024-06-10">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-10 - 2024-06-24">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-24 - 2024-07-01">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-01 - 2024-07-15">‚ùå</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-15 - 2024-07-29">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-29 - 2024-08-12">üî≤</span></span>
                </li>
<li>
                   <img src="https://cdn.rawgit.com/sunpy/sunpy-logo/master/generated/sunpy_icon.svg" height="16" width="16"><a href="https://medium.com/@manitsingh018" data-toggle="tooltip" data-placement="top" title="2024-07-23 16:50:13+01:00" style="color:rgb(255,0,0)">
                    Manit Singh
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-05-27 - 2024-06-10">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-10 - 2024-06-24">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-24 - 2024-07-01">‚ùå</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-01 - 2024-07-15">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-15 - 2024-07-29">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-29 - 2024-08-12">üî≤</span></span>
                </li>
<li>
                   <img src="https://cdn.rawgit.com/sunpy/sunpy-logo/master/generated/sunpy_icon.svg" height="16" width="16"><a href="https://viciouseagle03.github.io" data-toggle="tooltip" data-placement="top" title="2024-07-28 10:14:09+01:00">
                    ViciousEagle03
                   </a>
                   <span class="table-done" style="float: right; padding-right:600px;"><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-05-27 - 2024-06-10">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-10 - 2024-06-24">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-06-24 - 2024-07-01">‚ùå</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-01 - 2024-07-15">‚ùå</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-15 - 2024-07-29">‚úÖ</span><span style="display:table-cell; width:7%;" data-toggle="tooltip" title="2024-07-29 - 2024-08-12">üî≤</span></span>
                </li>
</ul></div>
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Deeper into OpenCL</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../../authors/deadspheroid/">DeadSpheroid</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2024-06-22T20:45:00+01:00" itemprop="datePublished" title="2024-06-22 20:45">2024-06-22 20:45</time></a>
            </p>
            

                    <p class="linkline"><a href="https://deadspheroid.github.io/my-blog/post/DelvingDeeper/">Original site</a></p>
        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p class="intro">In this post, I hope to give a high level understanding of OpenCL and its workings</p>

<h2 id="setting-it-up">Setting it up</h2>
<!-- TEASER_END -->
<p align="center" width="100%">
<img alt="OpenCL ICD" src="https://deadspheroid.github.io/my-blog/assets/img/ocl-icd.png" style="margin-bottom: 0; margin-top: 24px;"></p>
<p>OpenCL is relatively easy to get up and running on your system.</p>

<ul>
<li>
<p>For users:
All you need, is the OpenCL runtime for your device!
In case of Nvidia, this comes with the Nvidia drivers, while for Intel CPUs, this has to be manually installed by a package manager.</p>
</li>
<li>
<p>For developers:
You will need the OpenCL library to link against, and the OpenCL headers as well, again easily available in your package manager.</p>
</li>
</ul>
<h2 id="heres-a-new-perspective">Here‚Äôs a new perspective</h2>
<p align="center" width="100%">
<img alt="OpenCL Platform Model" src="https://deadspheroid.github.io/my-blog/assets/img/ocl-platform.png" style="margin-bottom: 0; margin-top: 24px;"></p>
<p>OpenCL presents a general interface to the developer, no matter what the device or the architecture.</p>

<p>Firstly, we have the host, which is responsible for all the book-keeping, and task scheduling on the OpenCL device.</p>

<p>Then, we have our OpenCL device, which is divided into a number of compute units.
Each Compute Unit (CU) is further divided into a number of processing elements.</p>

<p>But what do these words actually mean?</p>

<p>Well, a Processing Element(PE) is a single unit, that is responsible for executing a single thread(also called a work item). Think of a single function being executed.</p>

<p>Each PE has its own private memory, not accessible by anyone, but this PE</p>

<p>A bunch of processing elements are grouped together to form a compute unit which, at a time, executes a single work group(grouping of many work items).</p>

<p>The CUs all share a global memory, accessible by anyone</p>

<p>So for a CPU, the maximum number of CU s is the number of CPU cores!</p>

<p>But why do you want work groups? Why not have work items only?</p>

<p>Well, having this grouping of work items, allows for a greater deal of complexity, because we can synchronize across items in a work group, have a local memory only for this work group, and more‚Ä¶</p>

<h2 id="a-complete-walkthrough">A complete walkthrough</h2>
<p align="center" width="100%">
<img alt="OpenCL Execution Model" src="https://deadspheroid.github.io/my-blog/assets/img/ocl-exec.png" style="margin-bottom: 0; margin-top: 24px;"></p>

<p>Let‚Äôs look at a typical workflow for an OpenCL program</p>

<h3 id="initialisation">Initialisation</h3>
<p>First we need to check the currently available OpenCL platforms, which are basically implementations of OpenCL available on your system</p>

<p>For example, you can have both Intel OpenCL and POCL OpenCL for your i7 CPU.</p>

<p>Then from these platforms, you need to choose a device to execute on. OpenCL supports CPUs, GPUs, FPGAs, and all sorts of accelerators.</p>

<h3 id="context">Context</h3>
<p>Once you have the platform and device you wish to use, you need to create an OpenCL context, which will handle everything for that particular platform and device.</p>

<h3 id="command-queue">Command Queue</h3>
<p>Then, you have to create a command queue, which, as the name suggests, will store any commands(kernels) you queue for execution, and dispatch them in order(or even out of order if you like!).</p>

<h3 id="kernel">Kernel</h3>
<p>After the command queue, you must compile the kernel source code(the api provides functions to do this), so that it can be executed later.</p>

<h3 id="memory">Memory</h3>
<p>Finally, one of the most important parts of this entire process, is passing the input to the OpenCL device.</p>

<p>Now, initially the data is stored on your CPU RAM, which is unfortunately inaccessible to your GPU.</p>

<p>Therefore you need to copy the data to your GPU RAM, using the <code class="language-plaintext highlighter-rouge">cl_mem</code> interface that OpenCL provides.</p>

<p>However, if you know that the device being used is the same CPU, then this copy can be skipped, to save time, using the <code class="language-plaintext highlighter-rouge">CL_MEM_USE_HOST_PTR</code> flag while creating a <code class="language-plaintext highlighter-rouge">cl_mem</code> object.</p>

<h3 id="execution">Execution</h3>
<p>At the end, you can use the command queue created earlier along with the <code class="language-plaintext highlighter-rouge">cl_mem</code> created previously to execute the compiled kernel on the device</p>

<p>Subsequently don‚Äôt forget to copy the output data back to CPU RAM, if the execution was done on GPU.</p>

<p>However, there‚Äôs still a ton of unexplained stuff like, ‚ÄúHow do you save the time wasted in copying data to the device?‚Äù or ‚ÄúCan you pass any data to the device? Even structs?‚Äù</p>

<p>We‚Äôll explore OpenCL more in subsequent posts.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../categories/gnuastro/" rel="tag">gnuastro</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../20240621_1329_kartikmandar/" rel="prev" title="Making the sidebar intuitive">Previous post</a>
            </li>
            <li class="next">
                <a href="../20240623_0000_code29563/" rel="next" title="Stark broadening and the Common API">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Contents ¬© 2024         <a href="mailto:openastronomy@openastronomy.com">OpenAstronomy</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License BY-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="../../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
